kind: pipeline
name: default

limit:
  concurrency: 1
  per_branch: true

steps:
- name: build android
  image: xennitee/android-docker-image:0
  commands:
    - ./gradlew buildDebug
  when:
    branch:
    - master
    event:
    - pull_request

steps:
- name: build android
  image: xennitee/android-docker-image:0
  commands:
    - ./gradlew assembleDebug
    - mv src/android-client/build/outputs/apk/debug/*.apk /data/drone/outputs/
  when:
    branch:
    - master
    event:
    - tag

- name: publish to github release
  image: plugins/github-release
  settings:
    api_key: 11d402907387d60538d18edb98f45262c2427a64
    files: /data/drone/outputs/*.apk
    draft: true
    prerelease: true
    note: src/android-client/CHANGELOG.md
    overwrite: true
  when:
    event:
    - tag
    branch:
    - master
